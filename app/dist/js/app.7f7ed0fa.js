(function(t){function e(e){for(var i,o,a=e[0],u=e[1],s=e[2],d=0,f=[];d<a.length;d++)o=a[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&f.push(r[o][0]),r[o]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(t[i]=u[i]);l&&l(e);while(f.length)f.shift()();return c.push.apply(c,s||[]),n()}function n(){for(var t,e=0;e<c.length;e++){for(var n=c[e],i=!0,a=1;a<n.length;a++){var u=n[a];0!==r[u]&&(i=!1)}i&&(c.splice(e--,1),t=o(o.s=n[0]))}return t}var i={},r={app:0},c=[];function o(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=t,o.c=i,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)o.d(n,i,function(e){return t[e]}.bind(null,i));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],u=a.push.bind(a);a.push=e,a=a.slice();for(var s=0;s<a.length;s++)e(a[s]);var l=u;c.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"461b":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var i=n("7a23");function r(t,e,n,r,c,o){var a=Object(i["n"])("Home");return Object(i["j"])(),Object(i["c"])(a)}var c={id:"canvas",class:"absolute text-center cursor-pointer"},o={key:0,class:"text-2xl font-bold fixed left-0 right-0 text-center z-20 bg-white flex flex-col justify-center items-center"},a=Object(i["f"])("div",{class:"font-bold text-2xl"},"Fetching data..",-1),u=Object(i["f"])("i",{class:"fa fa-spinner fa-spin mt-10 text-6xl"},null,-1),s=[a,u],l={key:1,class:"text-2xl font-bold fixed left-0 right-0 text-center z-20 bg-white flex justify-center items-center mt-0"},d={key:0,class:"mr-2"},f={key:1,class:"mr-2"},b=Object(i["f"])("i",{class:"fas fa-plus mr-1"},null,-1),v=Object(i["g"])(" Add "),h=[b,v];function p(t,e,n,r,a,u){var b=Object(i["n"])("Bubble"),v=Object(i["n"])("AddActivity");return Object(i["j"])(),Object(i["e"])(i["a"],null,[Object(i["f"])("div",c,[(Object(i["j"])(!0),Object(i["e"])(i["a"],null,Object(i["m"])(t.$store.getters.activities,(function(t){return Object(i["j"])(),Object(i["c"])(b,{key:t.title,activity:t},null,8,["activity"])})),128))]),t.$store.getters.isFetching?(Object(i["j"])(),Object(i["e"])("div",o,s)):(Object(i["j"])(),Object(i["e"])("div",l,[0===t.$store.getters.activities.length?(Object(i["j"])(),Object(i["e"])("span",d," Nothing here yet :( ")):(Object(i["j"])(),Object(i["e"])("span",f," Popular stuff ")),Object(i["f"])("div",{class:"plus my-2",onClick:e[0]||(e[0]=function(t){return r.toggleAddActivity()})},h)])),r.showAddActivity?(Object(i["j"])(),Object(i["c"])(v,{key:2,onActivityCreated:r.createActivity,onClose:e[1]||(e[1]=function(t){return r.toggleAddActivity()})},null,8,["onActivityCreated"])):Object(i["d"])("",!0)],64)}var m=n("1da1");n("96cf");function g(t,e,n,r,c,o){return Object(i["j"])(),Object(i["e"])("div",{onClick:e[0]||(e[0]=function(){return r.bubbleClicked&&r.bubbleClicked.apply(r,arguments)}),class:"draggable bg-gray-100 p-3 text-center absolute flex justify-center items-center flex-col text-xl rounded-full hover:bg-gray-200",style:Object(i["i"])({left:"".concat(r.bubble.x,"px"),top:"".concat(r.bubble.y,"px"),width:"".concat(r.bubble.size,"px"),height:"".concat(r.bubble.size,"px")})},[Object(i["f"])("h1",null,Object(i["o"])(n.activity.title),1),Object(i["f"])("p",null,Object(i["o"])(n.activity.likeCount),1)],4)}var y=n("d4ec"),j=n("bee2");n("a434");function x(t,e){return Math.floor(Math.random()*(e-t))+t}var O=function(){function t(){Object(y["a"])(this,t);var e=5e3;this.centerX=e+window.innerWidth/2,this.centerY=e+window.innerHeight/2;var n=.25;this.maxSize=window.innerHeight<window.innerWidth?n*window.innerHeight:n*window.innerWidth,this.minSize=.5*this.maxSize,this.positionLevel=1,this.randomPositions=[[this.centerX,this.centerY]]}return Object(j["a"])(t,[{key:"generateRandomPositions",value:function(){var t;if(!(this.randomPositions.length>0)){for(var e=[],n=0,i=[-this.positionLevel,this.positionLevel];n<i.length;n++)for(var r=i[n],c=-this.positionLevel;c<=this.positionLevel;++c)e.push([this.centerX+r*this.maxSize,this.centerY+c*this.maxSize]);for(var o=1-this.positionLevel;o<=this.positionLevel-1;++o)e.push([this.centerX+o*this.maxSize,this.centerY-this.positionLevel*this.maxSize],[this.centerX+o*this.maxSize,this.centerY+this.positionLevel*this.maxSize]);for(var a=x(Math.ceil(.2*e.length),Math.ceil(.5*e.length)),u=0;u<a;++u)e.splice(x(0,e.length-1),1);(t=this.randomPositions).push.apply(t,e),++this.positionLevel}}},{key:"getRandomPosition",value:function(){return this.generateRandomPositions(),this.randomPositions.shift()}},{key:"bubbleSize",value:function(t){var e=t*this.maxSize;return e<this.minSize?this.minSize:e}},{key:"createBubble",value:function(t){var e=this.bubbleSize(t),n=this.getRandomPosition(),i=(this.maxSize-e)/2,r=n[0]-e/2+x(-i,i),c=n[1]-e/2+x(-i,i);return{x:r,y:c,size:e}}}]),t}(),k=new O,w=(n("4de4"),n("d3b7"),n("b680"),n("bc3a")),A=n.n(w),C=function(){var t=A.a.create();return t.defaults.baseURL="http://localhost:8000/",t},L=C(),M=(n("4e82"),n("5502")),z=n("0e44"),P=Object(M["a"])({plugins:[Object(z["a"])({paths:["likedActivities"]})],state:function(){return{activities:[],maxLikeCount:null,userLatitude:null,userLongitude:null,isFetching:!1,likedActivities:{}}},mutations:{setActivities:function(t,e){var n=e.activities;n.sort((function(t,e){return e.likeCount-t.likeCount})),n.length>0?t.maxLikeCount=n[0].likeCount:t.maxLikeCount=0,t.activities=n},addActivity:function(t,e){var n=e.activity;t.activities.push(n),t.activities.sort((function(t,e){return e.likeCount-t.likeCount})),t.maxLikeCount=t.activities[0].likeCount},likeActivity:function(t,e){var n=e.activity;++n.likeCount,t.likedActivities[n.id]=!0},setLocation:function(t,e){var n=e.latitude,i=e.longitude;t.userLatitude=n,t.userLongitude=i},setFetching:function(t,e){var n=e.value;t.isFetching=n}},getters:{activities:function(t){return t.activities},maxLikeCount:function(t){return t.maxLikeCount},userLatitude:function(t){return t.userLatitude},userLongitude:function(t){return t.userLongitude},isFetching:function(t){return t.isFetching},likedActivities:function(t){return t.likedActivities}}}),S=P;function R(t,e,n,i){var r=6371e3,c=t*Math.PI/180,o=n*Math.PI/180,a=(n-t)*Math.PI/180,u=(i-e)*Math.PI/180,s=Math.sin(a/2)*Math.sin(a/2)+Math.cos(c)*Math.cos(o)*Math.sin(u/2)*Math.sin(u/2),l=2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s));return r*l}function F(){return T.apply(this,arguments)}function T(){return T=Object(m["a"])(regeneratorRuntime.mark((function t(){var e,n,i,r,c,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,L.get("api/activities");case 3:for(e=t.sent,n=e.data,i=5e4,n=n.filter((function(t){return R(S.getters.userLatitude,S.getters.userLongitude,t.latitude,t.longitude)<i})),r={},c=n.length-1;c>=0;--c)o=n[c],r[o.title]?n.splice(c,1):r[o.title]=1;if(0!==n.length){t.next=11;break}return t.abrupt("return");case 11:S.commit("setActivities",{activities:n}),t.next=17;break;case 14:return t.prev=14,t.t0=t["catch"](0),t.abrupt("return");case 17:case"end":return t.stop()}}),t,null,[[0,14]])}))),T.apply(this,arguments)}function X(t){return Y.apply(this,arguments)}function Y(){return Y=Object(m["a"])(regeneratorRuntime.mark((function t(e){var n,i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n={title:e,latitude:S.getters.userLatitude.toFixed(6),longitude:S.getters.userLongitude.toFixed(6),likeCount:0},t.next=4,L.post("api/activities/",n);case 4:i=t.sent,S.commit("addActivity",{activity:i.data}),t.next=11;break;case 8:return t.prev=8,t.t0=t["catch"](0),t.abrupt("return");case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))),Y.apply(this,arguments)}function H(t){return B.apply(this,arguments)}function B(){return B=Object(m["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,L.patch("api/activities/".concat(e.id,"/"),e);case 2:case"end":return t.stop()}}),t)}))),B.apply(this,arguments)}var _={name:"Bubble",props:{activity:{type:Object,required:!0}},setup:function(t){var e=0;S.getters.maxLikeCount>0&&(e=t.activity.likeCount/S.getters.maxLikeCount);var n=k.createBubble(e),i=!1;function r(){return c.apply(this,arguments)}function c(){return c=Object(m["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!S.getters.likedActivities[t.activity.id]){e.next=2;break}return e.abrupt("return");case 2:if(i){e.next=6;break}return setTimeout((function(){i=!1}),300),i=!0,e.abrupt("return");case 6:return S.commit("likeActivity",{activity:t.activity}),e.next=9,H(t.activity);case 9:i=!1;case 10:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}return{bubble:n,bubbleClicked:r}}},D=n("6b0d"),I=n.n(D);const W=I()(_,[["render",g]]);var $=W,q=Object(i["f"])("div",{class:"fixed inset-0 bg-black opacity-50 z-30 flex justify-center items-center"},null,-1),U={class:"h-64 w-80 z-40 rounded bg-white flex flex-col relative mx-auto p-2 text-center mt-2"},E=Object(i["f"])("h1",{class:"text-2xl font-bold mb-2"},"Add activity",-1),J=Object(i["f"])("p",{class:"mb-2"},"Watcha doing?",-1),K=["textContent"],N=Object(i["f"])("div",{class:"flex-1"},null,-1),V={class:"grid grid-cols-2 gap-5"};function G(t,e,n,r,c,o){return Object(i["j"])(),Object(i["e"])(i["a"],null,[q,Object(i["f"])("div",U,[E,J,Object(i["r"])(Object(i["f"])("input",{type:"text",placeholder:"Description..",class:"p-2 w-100 border rounded","onUpdate:modelValue":e[0]||(e[0]=function(t){return r.activityTitle=t}),onKeyup:e[1]||(e[1]=Object(i["s"])((function(t){return r.createActivity()}),["enter"]))},null,544),[[i["p"],r.activityTitle]]),Object(i["f"])("div",{class:"text-red-500 font-bold mt-2",textContent:Object(i["o"])(r.errorMessage)},null,8,K),N,Object(i["f"])("div",V,[Object(i["f"])("button",{onClick:e[2]||(e[2]=function(t){return r.createActivity()}),class:"bg-green-500 rounded p-2 hover:bg-green-300"},"Send"),Object(i["f"])("button",{class:"bg-red-500 rounded p-2 hover:bg-red-300",onClick:e[3]||(e[3]=function(e){return t.$emit("close")})},"Cancel")])])],64)}n("498a");var Q={name:"AddActivity",emits:["activityCreated","close"],setup:function(t,e){var n=e.emit,r=Object(i["l"])(""),c=Object(i["l"])("");function o(){var t=r.value.trim();t?(t=t[0].toUpperCase()+t.substring(1),t.length>30?c.value="Maximum length of 30 characters exceeded.":S.getters.activities.filter((function(e){return e.title===t})).length>0?c.value="There's a bubble with the same description in your area.":(n("activityCreated",t),n("close"))):c.value="Empty descriptions are not supported."}return{activityTitle:r,errorMessage:c,createActivity:o}}};const Z=I()(Q,[["render",G]]);var tt=Z;function et(t){var e=document.getElementById(t),n=0,i=0,r=0,c=0;function o(t){t=t||window.event,t.preventDefault(),t.touches&&(t=t.touches[0]),r=t.clientX,c=t.clientY,document.onmouseup=u,e.ontouchend=u,document.onmousemove=a,e.ontouchmove=a}function a(t){t=t||window.event,t.preventDefault(),t.touches&&(t=t.touches[0]),n=r-t.clientX,i=c-t.clientY,r=t.clientX,c=t.clientY,e.style.top=e.offsetTop-i+"px",e.style.left=e.offsetLeft-n+"px"}function u(){document.onmouseup=null,e.ontouchend=null,document.onmousemove=null,e.ontouchmove=null}e.onmousedown=o,e.ontouchstart=o}var nt={name:"Home",components:{Bubble:$,AddActivity:tt},mounted:function(){return Object(m["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:S.commit("setFetching",{value:!0}),S.commit("setActivities",{activities:[]}),et("canvas"),navigator.geolocation.getCurrentPosition(function(){var t=Object(m["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return S.commit("setLocation",{latitude:e.coords.latitude,longitude:e.coords.longitude}),t.next=3,F();case 3:S.commit("setFetching",{value:!1});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(){alert("This app won't work without your location!"),S.commit("setFetching",{value:!1})}),{enableHighAccuracy:!0}),alert("Drag and drop the screen to see what's happening around you. Double click a bubble to like it.");case 5:case"end":return t.stop()}}),t)})))()},setup:function(){var t=Object(i["l"])(!1);function e(){t.value=!t.value}return{showAddActivity:t,toggleAddActivity:e,createActivity:X}}};n("bf18");const it=I()(nt,[["render",p]]);var rt=it,ct={name:"App",components:{Home:rt}};const ot=I()(ct,[["render",r]]);var at=ot;n("db43");n("becf"),n("7051");var ut=Object(i["b"])(at);ut.use(S),ut.mount("#app")},bf18:function(t,e,n){"use strict";n("461b")},db43:function(t,e,n){}});
//# sourceMappingURL=app.7f7ed0fa.js.map